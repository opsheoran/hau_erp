{% extends "base.html" %}

{% block breadcrumbs %}
<span>Masters</span>&nbsp;&gt;&nbsp;<span>Employee Masters</span>&nbsp;&gt;&nbsp;<strong>Employee Master</strong>
{% endblock %}

{% block content %}
<form method="POST" id="aspnetForm">
    <input type="hidden" name="_csrf_token" value="{{ csrf_token }}">
    <input type="hidden" name="edit_id" value="{{ edit_data.pk_empid if edit_data else '' }}">

    <!-- SHARED SEARCH MODAL -->
    {% include 'establishment/_search_modal.html' %}

    <table border="0" class="form-table" width="100%" cellspacing="0" cellpadding="0">
        <tbody>
            <tr>
                <td colspan="7" class="tableheading">
                    <span class="mainheadingborderbottom">Employee Master</span>
                </td>
            </tr>
            <tr><td colspan="7" class="tdgap" height="10"></td></tr>

            <!-- EMPLOYEE SEARCH SECTION -->
            <tr>
                <td colspan="6" class="tablesubheading">
                    <span class="subheadingborderbottom">Employee Search</span>
                </td>
                <td class="tablesubheading" align="right">
                    <a href="javascript:void(0);" data-bs-toggle="collapse" data-bs-target="#searchPanel" style="font-size:11px;">Show / Hide</a>
                </td>
            </tr>
            <tr>
                <td colspan="7">
                    <div class="collapse show" id="searchPanel">
                        <div style="background:#f9f9f9; padding:15px; border:1px solid var(--hau-border); margin-bottom:15px;">
                            <table border="0" width="100%">
                                <tr>
                                    <td class="vtext" width="15%">Employee Code</td><td class="colon">:</td>
                                    <td width="30%"><input type="text" name="s_emp_code" class="textbox w-200" value="{{ filters.empcode or '' }}"></td>
                                    <td width="5%"></td>
                                    <td class="vtext" width="15%">Manual Employee Code</td><td class="colon">:</td>
                                    <td width="30%"><input type="text" name="s_manual_emp_code" class="textbox w-200" value="{{ filters.manual_empcode or '' }}"></td>
                                </tr>
                                <tr>
                                    <td class="vtext">Employee Name</td><td class="colon">:</td>
                                    <td><input type="text" name="s_emp_name" class="textboxlong w-250" value="{{ filters.empname or '' }}"></td>
                                    <td></td>
                                    <td class="vtext">Controlling Office</td><td class="colon">:</td>
                                    <td>
                                        <select name="s_ctrl_id" class="dropdownlong w-250">
                                            <option value="">--Select Controlling Office--</option>
                                            {% for c in lookups.controlling_offices %}
                                            <option value="{{ c.id }}" {% if filters.ctrl_id|string == c.id|string %}selected{% endif %}>{{ c.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="vtext">Location</td><td class="colon">:</td>
                                    <td>
                                        <select name="s_loc_id" class="dropdownlong w-250">
                                            <option value="">--Select Location--</option>
                                            {% for l in lookups.locations %}
                                            <option value="{{ l.id }}" {% if filters.loc_id|string == l.id|string %}selected{% endif %}>{{ l.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                    <td></td>
                                    <td class="vtext">DDO</td><td class="colon">:</td>
                                    <td>
                                        <select name="s_ddo_id" class="dropdownlong w-250">
                                            <option value="">--Select DDO--</option>
                                            {% for d in lookups.ddos %}
                                            <option value="{{ d.id }}" {% if filters.ddo_id|string == d.id|string %}selected{% endif %}>{{ d.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="vtext">Designation</td><td class="colon">:</td>
                                    <td>
                                        <select name="s_desg_id" class="dropdownlong w-250">
                                            <option value="">-- Select Designation --</option>
                                            {% for d in lookups.designations %}
                                            <option value="{{ d.id }}" {% if filters.desg_id|string == d.id|string %}selected{% endif %}>{{ d.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                    <td></td>
                                    <td class="vtext">Department</td><td class="colon">:</td>
                                    <td>
                                        <select name="s_dept_id" class="dropdownlong w-250">
                                            <option value="">--Select Department--</option>
                                            {% for d in lookups.departments %}
                                            <option value="{{ d.id }}" {% if filters.dept_id|string == d.id|string %}selected{% endif %}>{{ d.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="vtext">Nature Type</td><td class="colon">:</td>
                                    <td>
                                        <select name="s_nature_id" class="dropdownlong w-250">
                                            <option value=""> -- Select Nature Type --</option>
                                            {% for n in lookups.nature_types %}
                                            <option value="{{ n.id }}" {% if filters.nature_id|string == n.id|string %}selected{% endif %}>{{ n.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                    <td></td>
                                    <td class="vtext">Section</td><td class="colon">:</td>
                                    <td>
                                        <select name="s_section_id" class="dropdownlong w-250">
                                            <option value="">-- Select Section --</option>
                                            {% for s in lookups.sections %}
                                            <option value="{{ s.id }}" {% if filters.section_id|string == s.id|string %}selected{% endif %}>{{ s.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="vtext">Fund Type</td><td class="colon">:</td>
                                    <td>
                                        <select name="s_fund_id" class="dropdownlong w-250">
                                            <option value=""> -- Select Fund Type --</option>
                                            {% for f in lookups.fund_types %}
                                            <option value="{{ f.id }}" {% if filters.fund_id|string == f.id|string %}selected{% endif %}>{{ f.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                    <td></td>
                                    <td class="vtext">Posting City</td><td class="colon">:</td>
                                    <td>
                                        <select name="s_city_id" class="dropdownlong w-250">
                                            <option value="">-- Select Posting City --</option>
                                            {% for c in lookups.cities %}
                                            <option value="{{ c.id }}" {% if filters.city_id|string == c.id|string %}selected{% endif %}>{{ c.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="vtext">Scheme Group</td><td class="colon">:</td>
                                    <td>
                                        <select name="s_scheme_group" class="dropdownlong w-250">
                                            <option value="">--Select Scheme Group--</option>
                                            {% for g in lookups.scheme_groups %}
                                            <option value="{{ g.id }}" {% if filters.scheme_group == g.id %}selected{% endif %}>{{ g.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                    <td></td>
                                    <td class="vtext">Employee Status</td><td class="colon">:</td>
                                    <td>
                                        <select name="s_status" class="dropdownlong w-250">
                                            <option value="A" {% if filters.status == 'A' %}selected{% endif %}>-- All Employee --</option>
                                            <option value="T" {% if filters.status == 'T' %}selected{% endif %}>TRANSFERD</option>
                                            <option value="S" {% if filters.status == 'S' %}selected{% endif %}>SUSPENDED</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="vtext">Scheme Code</td><td class="colon">:</td>
                                    <td>
                                        <select name="s_scheme_id" class="dropdownlong w-250">
                                            <option value=""> -- Select Scheme Code --</option>
                                            {% for s in lookups.schemes %}
                                            <option value="{{ s.id }}" {% if filters.scheme_id|string == s.id|string %}selected{% endif %}>{{ s.id }} | {{ s.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                    <td></td>
                                    <td class="vtext">Sort By</td><td class="colon">:</td>
                                    <td>
                                        <select name="s_sort_by" class="dropdownlong w-250">
                                            <option value="manualempcode">Employee Code</option>
                                            <option value="empname">Employee Name</option>
                                            <option value="fk_locid">Location</option>
                                            <option value="fk_deptid">Department</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="vtext">Type of Medical Allowance</td><td class="colon">:</td>
                                    <td>
                                        <select name="s_med_type" class="dropdownlong w-250">
                                            <option value="">-- Select Medical Allowance Type --</option>
                                            <option value="F">Fixed Medical Allowance</option>
                                            <option value="C">Chronic Patient reimbursement </option>
                                            <option value="W">Without Medical Allowance </option>
                                        </select>
                                    </td>
                                    <td colspan="4"></td>
                                </tr>
                                <tr>
                                    <td colspan="7" align="left" style="padding-top:10px;">
                                        <input type="submit" name="action" value="VIEW" class="button-common" formnovalidate>
                                        <input type="submit" name="action" value="RESET" class="button-common" formnovalidate>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </td>
            </tr>

            <!-- EMPLOYEE LIST GRID -->
            <tr>
                <td class="tablesubheading" colspan="7">
                    <span class="subheadingborderbottom">List of Employee(s)</span>
                </td>
            </tr>
            <tr>
                <td colspan="7">
                    <table class="table-grid-view" width="100%" cellspacing="1" cellpadding="1" border="1">
                        <thead>
                            <tr class="header-style">
                                <th width="5%">S. No.</th>
                                <th width="10%">Employee Code</th>
                                <th width="20%">Employee Name</th>
                                <th width="15%">Controlling Officer</th>
                                <th width="15%">Department</th>
                                <th width="15%">Designation</th>
                                <th width="15%">Posting Department</th>
                                <th width="8%">EDIT</th>
                                <th width="8%">DELETE</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for e in employees %}
                            <tr class="{% if loop.index % 2 == 0 %}item-style-alt{% else %}item-style{% endif %}">
                                <td align="center">{{ loop.index + pagination.per_page * (pagination.page - 1) }}</td>
                                <td align="center">{{ e.empcode }}</td>
                                <td>{{ e.empname }}</td>
                                <td>{{ e.ctrl_name }}</td>
                                <td>{{ e.dept_name }}</td>
                                <td>{{ e.designation }}</td>
                                <td>{{ e.posted_dept_name }}</td>
                                <td align="center">
                                    <a href="{{ url_for('establishment.employee_master', edit_id=e.id, page=pagination.page, s_emp_code=filters.empcode, s_emp_name=filters.empname) }}">
                                        <img src="{{ url_for('static', filename='images/Edit.gif') }}" alt="Edit">
                                    </a>
                                </td>
                                <td align="center">
                                    <img src="{{ url_for('static', filename='images/Delete.gif') }}" alt="Delete">
                                </td>
                            </tr>
                            {% else %}
                            <tr><td colspan="9" align="center" style="padding:10px;">No records found.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <div style="margin-top:10px;">
                        {% include 'includes/pagination.html' %}
                    </div>
                </td>
            </tr>

            <!-- MAIN DETAIL SECTION -->
            <tr><td colspan="7" height="20"></td></tr>
            <tr>
                <td colspan="7" class="tablesubheading">
                    <span class="subheadingborderbottom">Main Detail</span>
                </td>
            </tr>
            <tr>
                <td class="vtext" width="15%">Employee Code</td>
                <td class="colon">:</td>
                <td class="required" width="30%">
                    <input name="empcode" type="text" class="textbox w-150" value="{{ edit_data.empcode if edit_data else '' }}" readonly>
                    <a href="javascript:void(0);" onclick="openEmpSearch('edit_id', '')">
                        <img src="{{ url_for('static', filename='srec.jpg') }}" border="0" style="vertical-align:middle; cursor:pointer;">
                    </a>
                    <span class="required">*</span>
                </td>
                <td width="2%"></td>
                <td class="vtext" width="20%">Employee Code (M)</td>
                <td class="colon">:</td>
                <td class="required" width="25%">
                    <input name="manualcode" type="text" class="textbox w-150" value="{{ edit_data.manualempcode if edit_data else '' }}">
                    <span class="required">*</span>
                </td>
            </tr>
            <tr>
                <td class="vtext">Employee Name</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="salutation_id" class="dropdown w-75">
                        {% for s in lookups.salutations %}
                        <option value="{{ s.id }}" {% if edit_data and edit_data.fK_Salutation_ID|string == s.id|string %}selected{% endif %}>{{ s.name }}</option>
                        {% endfor %}
                    </select>
                    <input name="empname" type="text" class="textbox w-180" value="{{ edit_data.empname if edit_data else '' }}" required>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Father/Husband Name</td>
                <td class="colon">:</td>
                <td class="required"><input name="fathername" type="text" class="textbox w-250" value="{{ edit_data.fathername if edit_data else '' }}"></td>
            </tr>
            <tr>
                <td class="vtext">ID Card No.</td>
                <td class="colon">:</td>
                <td class="required"><input name="idcard" type="text" class="textbox w-250" value="{{ edit_data.idcard if edit_data else '' }}"></td>
                <td></td>
                <td class="vtext">Order No. of First Appointment</td>
                <td class="colon">:</td>
                <td class="required"><input name="orderno" type="text" class="textbox w-250" value="{{ edit_data.OrderNo if edit_data else '' }}"></td>
            </tr>
            <tr>
                <td class="vtext">Gender</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="gender" class="dropdown w-150">
                        <option value="">-- Select Gender --</option>
                        <option value="M" {% if edit_data and edit_data.gender == 'M' %}selected{% endif %}>Male</option>
                        <option value="F" {% if edit_data and edit_data.gender == 'F' %}selected{% endif %}>Female</option>
                    </select>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Category</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="cat_id" class="dropdown w-200">
                        <option value="">-- Select Caste Category --</option>
                        {% for c in lookups.categories %}
                        <option value="{{ c.id }}" {% if edit_data and edit_data.fk_catid|string == c.id|string %}selected{% endif %}>{{ c.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
            </tr>
            <tr>
                <td class="vtext">Religion</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="rel_id" class="dropdown w-200">
                        <option value="">-- Select Religion --</option>
                        {% for r in lookups.religions %}
                        <option value="{{ r.id }}" {% if edit_data and edit_data.fk_religionid|string == r.id|string %}selected{% endif %}>{{ r.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Marital Status</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="marital_id" class="dropdown w-200">
                        <option value="">-- Select Status --</option>
                        {% for m in lookups.marital_statuses %}
                        <option value="{{ m.id }}" {% if edit_data and edit_data.martialstatus|string == m.id|string %}selected{% endif %}>{{ m.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
            </tr>
            <tr>
                <td class="vtext">Date of Birth</td>
                <td class="colon">:</td>
                <td class="required">
                    <input name="dob" type="date" class="textbox w-150" value="{{ edit_data.dob_fmt if edit_data else '' }}" required>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Email Id</td>
                <td class="colon">:</td>
                <td class="required"><input name="email" type="text" class="textbox w-250" value="{{ edit_data.email if edit_data else '' }}"></td>
            </tr>
            <tr>
                <td class="vtext">PAN Number</td>
                <td class="colon">:</td>
                <td class="required"><input name="panno" type="text" class="textbox w-150" value="{{ edit_data.panno if edit_data else '' }}"></td>
                <td></td>
                <td class="vtext">ECR No.</td>
                <td class="colon">:</td>
                <td class="required"><input name="ecrno" type="text" class="textbox w-250" value="{{ edit_data.ecrno if edit_data else '' }}"></td>
            </tr>
            <tr>
                <td class="vtext">Aadhaar Number</td>
                <td class="colon">:</td>
                <td class="required"><input name="aadhaarno" type="text" class="textbox w-150" value="{{ edit_data.AadhaarNo if edit_data else '' }}"></td>
                <td></td>
                <td class="vtext">ECR Page No.</td>
                <td class="colon">:</td>
                <td class="required"><input name="ecrpageno" type="text" class="textbox w-250" value="{{ edit_data.ecrpageno if edit_data else '' }}"></td>
            </tr>
            <tr>
                <td class="vtext">Library Card Number</td>
                <td class="colon">:</td>
                <td class="required">
                    <input name="libcardno" type="text" class="textbox w-150" value="{{ edit_data.LibraryCardNo if edit_data else '' }}">
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Remarks</td>
                <td class="colon">:</td>
                <td><textarea name="remarks" class="textbox w-250" rows="2">{{ edit_data.remarks if edit_data else '' }}</textarea></td>
            </tr>

            <!-- BANK DETAILS SECTION -->
            <tr><td colspan="7" height="20"></td></tr>
            <tr>
                <td colspan="7" class="tablesubheading">
                    <span class="subheadingborderbottom">Bank Detail</span>
                </td>
            </tr>
            <tr>
                <td class="vtext">Pay Mode</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="paymode" class="dropdown w-150">
                        <option value="B" {% if edit_data and edit_data.paymode == 'B' %}selected{% endif %}>Bank</option>
                        <option value="Q" {% if edit_data and edit_data.paymode == 'Q' %}selected{% endif %}>Cheque</option>
                        <option value="C" {% if edit_data and edit_data.paymode == 'C' %}selected{% endif %}>Cash</option>
                        <option value="D" {% if edit_data and edit_data.paymode == 'D' %}selected{% endif %}>Direct</option>
                    </select>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Account No.</td>
                <td class="colon">:</td>
                <td class="required"><input name="accno" type="text" class="textbox w-200" value="{{ edit_data.bankaccountno if edit_data else '' }}"></td>
            </tr>
            <tr>
                <td class="vtext">Bank</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="bank_id" class="dropdown w-250">
                        <option value="">-- Select Bank --</option>
                        {% for b in lookups.banks %}
                        <option value="{{ b.id }}" {% if edit_data and edit_data.fk_bankid|string == b.id|string %}selected{% endif %}>{{ b.name }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td colspan="4"></td>
            </tr>

            <!-- OTHER DETAIL SECTION -->
            <tr><td colspan="7" height="20"></td></tr>
            <tr>
                <td colspan="7" class="tablesubheading">
                    <span class="subheadingborderbottom">Other Detail</span>
                </td>
            </tr>
            <tr>
                <td class="vtext">Actual Controlling Office</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="actual_ctrl_id" class="dropdown w-250">
                        <option value="">--Select Controlling Office</option>
                        {% for c in lookups.controlling_offices %}
                        <option value="{{ c.id }}" {% if edit_data and edit_data.fk_controllingid|string == c.id|string %}selected{% endif %}>{{ c.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Posting Controlling Office</td>
                <td class="colon">:</td>
                <td>
                    <select name="posted_ctrl_id" class="dropdown w-250">
                        <option value="">--Select Controlling Office</option>
                        {% for c in lookups.controlling_offices %}
                        <option value="{{ c.id }}" {% if edit_data and edit_data.fk_postedcontrollingid|string == c.id|string %}selected{% endif %}>{{ c.name }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            <tr>
                <td class="vtext">Actual DDO</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="actual_ddo_id" class="dropdown w-250">
                        <option value="">--Select DDO--</option>
                        {% for d in lookups.ddos %}
                        <option value="{{ d.id }}" {% if edit_data and edit_data.fk_ddoid|string == d.id|string %}selected{% endif %}>{{ d.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Posting DDO</td>
                <td class="colon">:</td>
                <td>
                    <select name="posted_ddo_id" class="dropdown w-250">
                        <option value="">--Select DDO--</option>
                        {% for d in lookups.ddos %}
                        <option value="{{ d.id }}" {% if edit_data and edit_data.postingddo|string == d.id|string %}selected{% endif %}>{{ d.name }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            <tr>
                <td class="vtext">Actual Location</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="actual_loc_id" class="dropdown w-250">
                        <option value="">-- Select Posting Location --</option>
                        {% for l in lookups.locations %}
                        <option value="{{ l.id }}" {% if edit_data and edit_data.fk_locid|string == l.id|string %}selected{% endif %}>{{ l.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Posting Location</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="posted_loc_id" class="dropdown w-250">
                        <option value="">--Select Location--</option>
                        {% for l in lookups.locations %}
                        <option value="{{ l.id }}" {% if edit_data and edit_data.fk_postedlocid|string == l.id|string %}selected{% endif %}>{{ l.name }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            <tr>
                <td class="vtext">Actual Department</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="actual_dept_id" class="dropdown w-250">
                        <option value="">--Select Department--</option>
                        {% for d in lookups.departments %}
                        <option value="{{ d.id }}" {% if edit_data and edit_data.fk_deptid|string == d.id|string %}selected{% endif %}>{{ d.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Posted Department</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="posted_dept_id" class="dropdown w-250">
                        <option value="">--Select Department--</option>
                        {% for d in lookups.departments %}
                        <option value="{{ d.id }}" {% if edit_data and edit_data.fk_Pdeptid|string == d.id|string %}selected{% endif %}>{{ d.name }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            <tr>
                <td class="vtext">Section</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="section_id" class="dropdown w-200">
                        <option value="">-- Select Section --</option>
                        {% for s in lookups.sections %}
                        <option value="{{ s.id }}" {% if edit_data and edit_data.fk_sectionid|string == s.id|string %}selected{% endif %}>{{ s.name }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td></td>
                <td class="vtext">Posted Section</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="posted_section_id" class="dropdown w-200">
                        <option value="">-- Select Section --</option>
                        {% for s in lookups.sections %}
                        <option value="{{ s.id }}" {% if edit_data and edit_data.fk_postedsectionid|string == s.id|string %}selected{% endif %}>{{ s.name }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            <tr>
                <td class="vtext">Date of Appointment</td>
                <td class="colon">:</td>
                <td class="required">
                    <input name="doa" type="date" class="textbox w-150" value="{{ edit_data.doa_fmt if edit_data else '' }}">
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Date of Joining</td>
                <td class="colon">:</td>
                <td class="required">
                    <input name="doj" type="date" class="textbox w-150" value="{{ edit_data.doj_fmt if edit_data else '' }}">
                    <span class="required">*</span>
                    <select name="joining_time" class="dropdown w-100">
                        <option value="F" {% if edit_data and edit_data.AppointmentTime == 'F' %}selected{% endif %}>Fore Noon</option>
                        <option value="A" {% if edit_data and edit_data.AppointmentTime == 'A' %}selected{% endif %}>After Noon</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="vtext">Discipline</td>
                <td class="colon">:</td>
                <td>
                    <select name="discipline_id" class="dropdown w-250">
                        <option value=""> -- Select Discipline Name --</option>
                        {% for d in lookups.disciplines %}
                        <option value="{{ d.id }}" {% if edit_data and edit_data.fk_disid|string == d.id|string %}selected{% endif %}>{{ d.name }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td></td>
                <td class="vtext">Last Appointment Date</td>
                <td class="colon">:</td>
                <td class="required">
                    <input name="last_doa" type="date" class="textbox w-150" value="{{ edit_data.last_doa_fmt if edit_data else '' }}">
                </td>
            </tr>
            <tr>
                <td class="vtext">Date of Retirement</td>
                <td class="colon">:</td>
                <td><input name="dor" type="date" id="txtDOR" class="textbox w-150" value="{{ edit_data.dor_fmt if edit_data else '' }}" readonly></td>
                <td></td>
                <td class="vtext">Last Joining Date</td>
                <td class="colon">:</td>
                <td class="required">
                    <input name="last_doj" type="date" class="textbox w-150" value="{{ edit_data.last_doj_fmt if edit_data else '' }}">
                </td>
            </tr>
            <tr>
                <td class="vtext">Nature Type</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="nature_id" class="dropdown w-250">
                        <option value=""> -- Select Nature Type --</option>
                        {% for n in lookups.nature_types %}
                        <option value="{{ n.id }}" {% if edit_data and edit_data.fk_natureid|string == n.id|string %}selected{% endif %}>{{ n.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Employee's Left Status</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="left_status" class="dropdown w-100">
                        <option value="N" {% if edit_data and edit_data.employeeleftstatus == 'N' %}selected{% endif %}>NO</option>
                        <option value="Y" {% if edit_data and edit_data.employeeleftstatus == 'Y' %}selected{% endif %}>YES</option>
                    </select>
                    <select name="left_reason" class="dropdown w-150">
                        <option value="N">-- Select Reason --</option>
                        <option value="R">Retirement</option>
                        <option value="D">Death</option>
                        <option value="G">Resignation</option>
                        <option value="T">Termination</option>
                        <option value="U">Deputation</option>
                        <option value="V">Voluntary Retirement</option>
                        <option value="S">Supermation</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="vtext">Fund Type</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="fund_id" class="dropdown w-250">
                        <option value=""> -- Select Fund Type --</option>
                        {% for f in lookups.fund_types %}
                        <option value="{{ f.id }}" {% if edit_data and edit_data.fk_fundid|string == f.id|string %}selected{% endif %}>{{ f.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Leaving Date</td>
                <td class="colon">:</td>
                <td class="required">
                    <input name="left_date" type="date" class="textbox w-150" value="{{ edit_data.left_date_fmt if edit_data else '' }}">
                </td>
            </tr>
            <tr>
                <td class="vtext">Scheme</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="scheme_id" class="dropdownlong w-250">
                        <option value="">--Select Scheme Group--</option>
                        {% for s in lookups.scheme_groups %}
                        <option value="{{ s.id }}" {% if edit_data and edit_data.fk_subanc|string == s.id|string %}selected{% endif %}>{{ s.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
            </tr>
            <tr>
                <td class="vtext">Scheme Code</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="scheme_code_id" class="dropdownlong w-250">
                        <option value=""> -- Select Scheme Code --</option>
                        {% for s in lookups.schemes %}
                        <option value="{{ s.id }}" {% if edit_data and edit_data.fk_subanc|string == s.id|string %}selected{% endif %}>{{ s.id }} | {{ s.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Leaving Remarks</td>
                <td class="colon">:</td>
                <td class="required"><input name="left_remarks" type="text" class="textbox w-250" value="{{ edit_data.leftremarks if edit_data else '' }}"></td>
            </tr>
            <tr>
                <td class="vtext">Reporting To</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="reporting_to" class="dropdownlong w-250">
                        <option value="">-- Select Reporting To --</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="vtext">Increment Due Date</td>
                <td class="colon">:</td>
                <td class="required">
                    <input name="inc_date" type="date" class="textbox w-150" value="{{ edit_data.inc_date_fmt if edit_data else '' }}">
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">PF Bank</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="pf_bank_id" class="dropdown w-250">
                        <option value="">--Select PF Bank--</option>
                        {% for b in lookups.banks %}
                        <option value="{{ b.id }}" {% if edit_data and edit_data.fk_bankid|string == b.id|string %}selected{% endif %}>{{ b.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
            </tr>
            <tr>
                <td class="vtext">On Deputation?</td>
                <td class="colon">:</td>
                <td><input type="checkbox" name="on_deputation" value="1" {% if edit_data and edit_data.ondeputation %}checked{% endif %}></td>
                <td></td>
                <td class="vtext">PF Number/PRAN Number</td>
                <td class="colon">:</td>
                <td class="required"><input name="pf_no" type="text" class="textbox w-150" value="{{ edit_data.pfileno if edit_data else '' }}"></td>
            </tr>
            <tr>
                <td class="vtext">Welfare Number</td>
                <td class="colon">:</td>
                <td class="required"><input name="welfare_no" type="text" class="textbox w-250" value="{{ edit_data.mbfno if edit_data else '' }}"></td>
                <td></td>
                <td class="vtext">From DDO</td>
                <td class="colon">:</td>
                <td class="required"><input name="from_ddo" type="text" class="textbox w-250"></td>
            </tr>
            <tr>
                <td class="vtext">PF Balance</td>
                <td class="colon">:</td>
                <td class="required"><input name="pf_balance" type="text" class="textbox w-150"></td>
                <td></td>
                <td class="vtext">PG Teacher Code</td>
                <td class="colon">:</td>
                <td><input name="pg_teacher_code" type="text" class="textbox w-150" value="{{ edit_data.pgteachercode if edit_data else '' }}"></td>
            </tr>
            <tr>
                <td class="vtext">SI Prem. No.</td>
                <td class="colon">:</td>
                <td><input name="si_prem_no" type="text" class="textbox w-250" value="{{ edit_data.sipremno if edit_data else '' }}"></td>
                <td></td>
                <td class="vtext">Association</td>
                <td class="colon">:</td>
                <td>
                    <select name="asso_id" class="dropdown w-200">
                        <option value="">-- Select Association --</option>
                        {% for a in lookups.associations %}
                        <option value="{{ a.id }}" {% if edit_data and edit_data.fK_Asso_ID|string == a.id|string %}selected{% endif %}>{{ a.name }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            <tr>
                <td class="vtext">Additional Charge</td>
                <td class="colon">:</td>
                <td><input name="add_charge" type="text" class="textbox w-250" value="{{ edit_data.addcharge if edit_data else '' }}"></td>
                <td></td>
                <td class="vtext">Type of Medical Allowance</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="medical_allowance_type" class="dropdown w-200">
                        <option value="F" {% if edit_data and edit_data.typeofallowance == 'F' %}selected{% endif %}>Fixed Medical Allowance</option>
                        <option value="C" {% if edit_data and edit_data.typeofallowance == 'C' %}selected{% endif %}>Chronic Patient reimbursement </option>
                        <option value="W" {% if edit_data and edit_data.typeofallowance == 'W' %}selected{% endif %}>Without Medical Allowance </option>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="vtext">Employee Type</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="emp_type" class="dropdown w-150">
                        <option value="H">HAU</option>
                        <option value="S">State Govt.</option>
                    </select>
                </td>
                <td></td>
                <td class="vtext">Medical Allowance Effective From</td>
                <td class="colon">:</td>
                <td class="required"><input name="med_eff_date" type="date" class="textbox w-150"></td>
            </tr>
            <tr>
                <td class="vtext">Stop Salary</td>
                <td class="colon">:</td>
                <td class="required"><input type="checkbox" name="stop_salary" value="1" {% if edit_data and edit_data.stopsalary %}checked{% endif %}></td>
                <td></td>
                <td class="vtext">Is Handicapped?</td>
                <td class="colon">:</td>
                <td class="required"><input type="checkbox" name="is_handicap" value="1" {% if edit_data and edit_data.ishandicap %}checked{% endif %}></td>
            </tr>
            <tr>
                <td class="vtext">Stop GPF</td>
                <td class="colon">:</td>
                <td class="required"><input type="checkbox" name="stop_gpf" value="1" {% if edit_data and edit_data.stoppf %}checked{% endif %}></td>
                <td></td>
                <td class="vtext">Stop Attendance</td>
                <td class="colon">:</td>
                <td class="required"><input type="checkbox" name="stop_attendance" value="1" {% if edit_data and edit_data.stopattendance %}checked{% endif %}></td>
            </tr>
            <tr>
                <td class="vtext">HRA/HRD Not Applicable</td>
                <td class="colon">:</td>
                <td class="required"><input type="checkbox" name="hra_not_app" value="1" {% if edit_data and edit_data.hrahrdnotapplicable %}checked{% endif %}></td>
                <td></td>
                <td class="vtext">Is Gazetted?</td>
                <td class="colon">:</td>
                <td class="required"><input type="checkbox" name="is_gazetted" value="1" {% if edit_data and edit_data.isgazetted %}checked{% endif %}></td>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td></td>
                <td class="vtext">Work Details</td>
                <td class="colon">:</td>
                <td class="required"><textarea name="work_details" class="textbox w-250" rows="2">{{ edit_data.workdetails if edit_data else '' }}</textarea></td>
            </tr>

            <!-- DEFINE SALARY STRUCTURE SECTION -->
            <tr><td colspan="7" height="20"></td></tr>
            <tr>
                <td colspan="7" class="tablesubheading">
                    <span class="subheadingborderbottom">Define Salary Structure</span>
                </td>
            </tr>
            <tr>
                <td class="vtext">Salary Type</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="sal_type_id" class="dropdown w-200">
                        {% for s in lookups.salary_types %}
                        <option value="{{ s.id }}" {% if edit_data and edit_data.fk_saltypeid|string == s.id|string %}selected{% endif %}>{{ s.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Posting Station</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="posting_city_id" class="dropdown w-200">
                        {% for c in lookups.cities %}
                        <option value="{{ c.id }}" {% if edit_data and edit_data.fk_cityid|string == c.id|string %}selected{% endif %}>{{ c.name }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            <tr>
                <td class="vtext">Post</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="post_desg_id" class="dropdown w-250">
                        {% for d in lookups.designations %}
                        <option value="{{ d.id }}" {% if edit_data and edit_data.fk_desgid|string == d.id|string %}selected{% endif %}>{{ d.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Working Designation</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="working_desg_id" class="dropdown w-250">
                        {% for d in lookups.designations %}
                        <option value="{{ d.id }}" {% if edit_data and edit_data.fk_desgid|string == d.id|string %}selected{% endif %}>{{ d.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
            </tr>
            <tr>
                <td class="vtext">Department Specialization</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="spec_id" class="dropdown w-250">
                        <option value="">-- Select Specialization --</option>
                        {% for s in lookups.specializations %}
                        <option value="{{ s.id }}" {% if edit_data and edit_data.fK_DesignspecId|string == s.id|string %}selected{% endif %}>{{ s.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Posted Department Specialization</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="posted_spec_id" class="dropdown w-250">
                        <option value="">-- Select Specialization --</option>
                        {% for s in lookups.specializations %}
                        <option value="{{ s.id }}" {% if edit_data and edit_data.fK_PDesignspecId|string == s.id|string %}selected{% endif %}>{{ s.name }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            <tr>
                <td class="vtext">Grade</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="grade_id" class="dropdown w-250">
                        {% for g in lookups.grades %}
                        <option value="{{ g.id }}" {% if edit_data and edit_data.fk_gradeid|string == g.id|string %}selected{% endif %}>{{ g.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
                <td></td>
                <td class="vtext">Current Grade</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="current_grade_id" class="dropdown w-250">
                        {% for g in lookups.grades %}
                        <option value="{{ g.id }}" {% if edit_data and edit_data.fk_gradeid|string == g.id|string %}selected{% endif %}>{{ g.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="required">*</span>
                </td>
            </tr>
            <tr>
                <td class="vtext">Level Type</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="level_type" class="dropdown w-150">
                        <option value="ACADEMIC">Academic Level</option>
                    </select>
                </td>
                <td></td>
                <td class="vtext">Level Number</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="level_name" class="dropdown w-150">
                        <option value="14">L14</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="vtext">Cell Number</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="cell_number" class="dropdown w-150">
                        <option value="10">10</option>
                    </select>
                </td>
                <td></td>
                <td class="vtext">Grade Pay</td>
                <td class="colon">:</td>
                <td class="required"><input name="gradepay" type="text" class="textbox w-150" value="{{ edit_data.gradepay if edit_data else '' }}"></td>
            </tr>
            <tr>
                <td class="vtext">Current Grade Pay</td>
                <td class="colon">:</td>
                <td class="required"><input name="cgradepay" type="text" class="textbox w-150" value="{{ edit_data.cgradepay if edit_data else '' }}"></td>
                <td></td>
                <td class="vtext">PF Type</td>
                <td class="colon">:</td>
                <td>
                    <select name="pf_type" class="dropdown w-100">
                        <option value="GPF" {% if edit_data and edit_data.pftype == 'G' %}selected{% endif %}>GPF</option>
                        <option value="CPF" {% if edit_data and edit_data.pftype == 'C' %}selected{% endif %}>CPF/EPF</option>
                        <option value="NPS" {% if edit_data and edit_data.pftype == 'P' %}selected{% endif %}>NPS</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="vtext">Quarter No.</td>
                <td class="colon">:</td>
                <td>
                    <select name="quarter_id" class="dropdown w-200">
                        <option value="">-- Select Quarter --</option>
                    </select>
                </td>
                <td></td>
                <td class="vtext">Basic</td>
                <td class="colon">:</td>
                <td class="required"><input name="basic" type="text" class="textbox w-150" value="{{ edit_data.curbasic if edit_data else '0' }}"> *</td>
            </tr>
            <tr>
                <td class="vtext">Quarter Effective From</td>
                <td class="colon">:</td>
                <td><input name="qtr_eff_date" type="date" class="textbox w-150"></td>
            </tr>
            <tr>
                <td class="vtext">Increment Percentage</td>
                <td class="colon">:</td>
                <td class="required"><input name="inc_percentage" type="text" class="textbox w-150" value="{{ edit_data.nextincamount if edit_data else '0' }}"></td>
                <td></td>
                <td class="vtext">Current Special Pay</td>
                <td class="colon">:</td>
                <td><input name="cspecialpay" type="text" class="textbox w-150" value="{{ edit_data.cspecialpay if edit_data else '0' }}"></td>
            </tr>
            <tr>
                <td class="vtext">Current CA</td>
                <td class="colon">:</td>
                <td><input name="cuca" type="text" class="textbox w-150" value="{{ edit_data.cuca if edit_data else '0' }}"></td>
                <td></td>
                <td class="vtext">Current Special Allowance</td>
                <td class="colon">:</td>
                <td><input name="cspecialallowance" type="text" class="textbox w-150" value="{{ edit_data.cspecialallowance if edit_data else '0' }}"></td>
            </tr>
            <tr>
                <td class="vtext">Phd. Allowance</td>
                <td class="colon">:</td>
                <td><input name="phd_allowance" type="text" class="textbox w-150" value="{{ edit_data.PhdAllowance if edit_data else '0' }}"></td>
                <td></td>
                <td class="vtext">GPF Share Percentage</td>
                <td class="colon">:</td>
                <td><input name="gpf_share" type="text" class="textbox w-150"></td>
            </tr>
            <tr>
                <td class="vtext">Month</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="sal_month" class="dropdown w-150">
                        <option value="1">JANUARY</option>
                        <option value="2" selected>FEBRUARY</option>
                    </select>
                </td>
                <td></td>
                <td class="vtext">Year</td>
                <td class="colon">:</td>
                <td class="required">
                    <select name="sal_year" class="dropdown w-150">
                        <option value="2026" selected>2026</option>
                    </select>
                </td>
            </tr>

            <!-- EARNINGS / DEDUCTIONS HEADS -->
            {% if edit_id %}
            <tr><td colspan="7" height="30"></td></tr>
            <tr>
                <td colspan="7">
                    <div style="display: flex; gap: 20px;">
                        <div style="flex: 1;">
                            <div class="tablesubheading">Earnings Head</div>
                            <table class="table-grid-view" cellspacing="1" cellpadding="1" border="1">
                                <thead>
                                    <tr class="header-style">
                                        <th width="10%">S.No.</th>
                                        <th>Description</th>
                                        <th width="15%">Mapping</th>
                                        <th width="25%">Amount</th>
                                        <th width="25%">Effective From</th>
                                        <th width="10%">Manual</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for h in earning_heads %}
                                    <tr class="item-style">
                                        <td align="center">{{ loop.index }}</td>
                                        <td>{{ h.description }}</td>
                                        <td align="center">{{ h.mapping }}</td>
                                        <td align="center">
                                            <input type="hidden" name="earn_head_id" value="{{ h.head_id }}">
                                            <input name="earn_amount_{{ h.head_id }}" type="text" class="textbox w-75" style="text-align:right;" value="{{ h.amount if h.amount is not none else '' }}">
                                        </td>
                                        <td align="center">
                                            <input name="earn_effect_{{ h.head_id }}" type="date" class="textbox w-75" value="{{ h.effect_date or '' }}">
                                        </td>
                                        <td align="center">
                                            <input type="checkbox" name="earn_manual_{{ h.head_id }}" value="1" {% if h.ismanual %}checked{% endif %}>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div style="flex: 1;">
                            <div class="tablesubheading">Deductions Head</div>
                            <table class="table-grid-view" cellspacing="1" cellpadding="1" border="1">
                                <thead>
                                    <tr class="header-style">
                                        <th width="10%">S.No.</th>
                                        <th>Description</th>
                                        <th width="15%">Mapping</th>
                                        <th width="25%">Amount</th>
                                        <th width="25%">Effective From</th>
                                        <th width="10%">Manual</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for h in deduction_heads %}
                                    <tr class="item-style">
                                        <td align="center">{{ loop.index }}</td>
                                        <td>{{ h.description }}</td>
                                        <td align="center">{{ h.mapping }}</td>
                                        <td align="center">
                                            <input type="hidden" name="ded_head_id" value="{{ h.head_id }}">
                                            <input name="ded_amount_{{ h.head_id }}" type="text" class="textbox w-75" style="text-align:right;" value="{{ h.amount if h.amount is not none else '' }}">
                                        </td>
                                        <td align="center">
                                            <input name="ded_effect_{{ h.head_id }}" type="date" class="textbox w-75" value="{{ h.effect_date or '' }}">
                                        </td>
                                        <td align="center">
                                            <input type="checkbox" name="ded_manual_{{ h.head_id }}" value="1" {% if h.ismanual %}checked{% endif %}>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="7">
                    <div style="float:right; width:300px; margin-top:15px; border:1px solid var(--hau-border); padding:15px; background:#f9f9f9;">
                        <table width="100%">
                            <tr><td class="vtext">Total Earnings:</td><td align="right"><b>{{ "%.2f"|format(total_earnings) }}</b></td></tr>
                            <tr><td class="vtext">Income Tax:</td><td align="right"><b>{{ "%.2f"|format(income_tax) }}</b></td></tr>
                            <tr><td class="vtext">Total Deductions:</td><td align="right"><b>{{ "%.2f"|format(total_deductions) }}</b></td></tr>
                            <tr style="border-top:1px solid #ccc; height:10px;"><td></td><td></td></tr>
                            <tr><td class="vtext" style="color:var(--hau-blue); font-size:12px;">Net Pay:</td><td align="right"><b style="color:var(--hau-blue); font-size:12px;">{{ "%.2f"|format(net_pay) }}</b></td></tr>
                        </table>
                    </div>
                </td>
            </tr>

            <!-- DOCUMENT DETAILS -->
            <tr><td colspan="7" height="30"></td></tr>
            <tr>
                <td colspan="7" class="tablesubheading">
                    <span class="subheadingborderbottom">Document Details</span>
                </td>
            </tr>
            <tr>
                <td colspan="7">
                    <table class="table-grid-view" width="40%" cellspacing="1" cellpadding="1" border="1">
                        <thead>
                            <tr class="header-style">
                                <th width="20%">S.No.</th>
                                <th>Document</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="item-style">
                                <td align="center">1</td>
                                <td>Photo</td>
                            </tr>
                        </tbody>
                    </table>
                </td>
            </tr>
            {% endif %}

            <tr><td colspan="7" height="30"></td></tr>
            <tr>
                <td colspan="7" align="center">
                    {% if perm.AllowAdd or perm.AllowUpdate %}
                    <input type="submit" name="action" value="{{ 'UPDATE' if edit_data else 'SAVE' }}" class="button-common">
                    {% endif %}
                    <input type="submit" name="action" value="RESET" class="button-common">
                </td>
            </tr>
        </tbody>
    </table>
</form>
{% endblock %}

{% block extra_js %}
<script>
    function getretirement() {
        var dobVal = document.getElementsByName("dob")[0].value;
        if(!dobVal) return;
        
        var datearray = dobVal.split("-"); // HTML5 date is YYYY-MM-DD
        if(datearray.length < 3) return;
        
        var year = parseInt(datearray[0], 10);
        var month = parseInt(datearray[1], 10);
        var day = parseInt(datearray[2], 10);
        
        var dor;
        if (day == 1)
            dor = new Date(year + 60, month - 1, 0); // Last day of previous month
        else
            dor = new Date(year + 60, month, 0);     // Last day of birth month
        
        var nyear = dor.getFullYear();
        var nmonth = dor.getMonth() + 1;
        var nday = dor.getDate();
        
        var dor_str = nyear + '-' + (nmonth < 10 ? '0' + nmonth : nmonth) + '-' + (nday < 10 ? '0' + nday : nday);
        document.getElementById("txtDOR").value = dor_str;
    }

    function selectItem(id, name) {
        window.location.href = "{{ url_for('establishment.employee_master') }}?edit_id=" + id;
    }

    document.addEventListener('DOMContentLoaded', function() {
        var dobInput = document.getElementsByName("dob")[0];
        if(dobInput) {
            dobInput.addEventListener('change', getretirement);
        }
    });
</script>
{% endblock %}
