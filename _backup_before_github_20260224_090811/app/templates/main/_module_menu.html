{% set current_mod_id = session.get('current_module_id')|string %}
{% set mod_rights = all_rights | selectattr('fk_moduleId', 'equalto', current_mod_id|int) | list %}

<style>
    .mod-nav { background: #3c8dbc; padding: 0; display: flex; list-style: none; border-radius: 0; margin-bottom: 0; }
    .mod-nav-item { position: relative; border-right: 1px solid rgba(255,255,255,0.1); }
    .mod-nav-link { display: block; padding: 10px 20px; color: #fff; text-decoration: none; font-weight: 600; font-size: 13px; }
    .mod-nav-link:hover { background: rgba(0,0,0,0.1); color: #fff; }
    .mod-dropdown { display: none; position: absolute; top: 100%; left: 0; background: white; border: 1px solid #ccc; min-width: 240px; z-index: 1000; list-style: none; padding: 0; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .mod-nav-item:hover .mod-dropdown { display: block; }
    .mod-dropdown-item { display: block; padding: 8px 15px; color: #333; text-decoration: none; border-bottom: 1px solid #f8f9fa; font-size: 12px; }
    .mod-dropdown-item:hover { background: #3498db; color: white; }
    .mod-dropdown-item i { font-size: 10px; margin-right: 8px; opacity: 0.5; }
</style>

<ul class="mod-nav shadow-sm mb-3">
    <li class="mod-nav-item">
        <a href="{{ url_for('main.index') }}" class="mod-nav-link"><i class="bi bi-house-fill"></i></a>
    </li>
    
    {# We group pages by their parent or just show them in a 'Services' dropdown #}
    <li class="mod-nav-item">
        <a href="#" class="mod-nav-link">SERVICES <i class="bi bi-chevron-down small ms-1"></i></a>
        <ul class="mod-dropdown">
            {% for r in mod_rights %}
            {% if r.AllowView %}
                {% set page_url = '#' %}
                {% if r.PageName == 'Employee Master' %}{% set page_url = url_for('establishment.employee_master') %}
                {% elif r.PageName == 'User Master' %}{% set page_url = url_for('umm.user_master') %}
                {% elif r.PageName == 'Leave Request' %}{% set page_url = url_for('leave.leave_request') %}
                {% elif r.PageName == 'Leave Approval' %}{% set page_url = url_for('leave.approvals') %}
                {% elif r.PageName == 'Leave Adjustment Request' %}{% set page_url = url_for('leave.leave_adjustment') %}
                {% elif r.PageName == 'Leave Adjustment Approval' %}{% set page_url = url_for('leave.adj_approvals') %}
                {% elif r.PageName == 'Leave Cancel Request' %}{% set page_url = url_for('leave.leave_cancel') %}
                {% elif r.PageName == 'Leave Cancel Approval' %}{% set page_url = url_for('leave.cancel_approvals') %}
                {% elif r.PageName == 'Salary Slip' %}{% set page_url = url_for('payroll.salary_slip_view') %}
                {% elif r.PageName == 'Department Master' and current_mod.modulename == 'Establishment' %}{% set page_url = url_for('establishment.department_master') %}
                {% elif r.PageName == 'Establishment Master' %}{% set page_url = url_for('establishment.list_masters') %}
                {% endif %}
                <li><a href="{{ page_url }}" class="mod-dropdown-item"><i class="bi bi-circle-fill"></i> {{ r.PageName }}</a></li>
            {% endif %}
            {% endfor %}
        </ul>
    </li>

    <li class="mod-nav-item">
        <a href="#" class="mod-nav-link">REPORTS <i class="bi bi-chevron-down small ms-1"></i></a>
        <ul class="mod-dropdown">
            <li><a href="#" class="mod-dropdown-item"><i class="bi bi-file-earmark-pdf"></i> Module Wise Report</a></li>
        </ul>
    </li>
</ul>
