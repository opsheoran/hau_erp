{% extends "base.html" %}
{% block content %}
<style>
    .module-grid-container { padding: 20px; }
    .module-row { display: flex; flex-wrap: wrap; margin: -10px; justify-content: flex-start; }
    .module-item { width: 20%; padding: 15px; text-align: center; } /* 5 per row */
    
    @media (max-width: 1200px) { .module-item { width: 25%; } } /* 4 per row */
    @media (max-width: 992px) { .module-item { width: 33.33%; } }
    @media (max-width: 768px) { .module-item { width: 50%; } }

    .module-box { 
        background: #fff; border: 1px solid #eee; padding: 25px 20px; transition: all 0.4s ease; cursor: pointer;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        text-decoration: none !important; border-radius: 8px; height: 100%;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .module-box:hover, .module-box:focus { 
        border-color: #3c8dbc; 
        box-shadow: 0 8px 25px rgba(60, 141, 188, 0.15); 
        transform: translateY(-8px); 
        outline: none;
    }
    
    .module-icon-img { 
        width: 72px; height: 72px; margin-bottom: 15px; 
        transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .module-box:hover .module-icon-img, .module-box:focus .module-icon-img { 
        transform: rotate(360deg); 
    }

    .module-name { 
        color: #444; font-weight: bold; font-size: 11px; 
        text-transform: uppercase; display: block; 
        transition: color 0.3s;
        letter-spacing: 0.5px;
    }
    .module-box:hover .module-name { color: #3c8dbc; }
    
    .grid-header { border-bottom: 2px solid #3c8dbc; padding-bottom: 12px; margin-bottom: 35px; display: flex; justify-content: space-between; align-items: center; }
    .grid-header h2 { font-size: 18px; font-weight: bold; color: #333; margin: 0; }
</style>

<div class="module-grid-container">
    <div class="grid-header">
        <h2><i class="fas fa-th-large me-2"></i> MODULES ASSIGNED</h2>
        <div class="no-print">
            <form method="GET" class="d-flex align-items-center">
                <span class="vtext me-2">Location:</span>
                <select name="loc_id" class="dropdown" style="width: 320px;" onchange="this.form.submit()">
                    <option value="">-- Select Your Campus --</option>
                    {% for loc in locations %}
                    <option value="{{ loc.id }}" {% if selected_loc|string == loc.id|string %}selected{% endif %}>{{ loc.name }}</option>
                    {% endfor %}
                </select>
            </form>
        </div>
    </div>

    <div class="module-row">
        {# Define the exact 21 modules and their corresponding high-quality icons #}
        {% set module_map = {
            'Admission & Academics': 'https://cdn-icons-png.flaticon.com/512/3429/3429402.png',
            'Employee Portal': 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png',
            'Financial Accounts': 'https://cdn-icons-png.flaticon.com/512/2845/2845838.png',
            'PF': 'https://cdn-icons-png.flaticon.com/512/2488/2488749.png',
            'Research': 'https://cdn-icons-png.flaticon.com/512/2821/2821735.png',
            'Student Attendance': 'https://cdn-icons-png.flaticon.com/512/4601/4601140.png',
            'Agriculture Farm Management': 'https://cdn-icons-png.flaticon.com/512/2329/2329384.png',
            'Establishment': 'https://cdn-icons-png.flaticon.com/512/9334/9334139.png',
            'HRMS': 'https://cdn-icons-png.flaticon.com/512/912/912318.png',
            'PreAdmission': 'https://cdn-icons-png.flaticon.com/512/3534/3534033.png',
            'RTI': 'https://cdn-icons-png.flaticon.com/512/2991/2991108.png',
            'Tax Management': 'https://cdn-icons-png.flaticon.com/512/2652/2662503.png',
            'Bill Tracking': 'https://cdn-icons-png.flaticon.com/512/1052/1052856.png',
            'Examination & Results': 'https://cdn-icons-png.flaticon.com/512/5053/5053841.png',
            'Leave Management': 'https://cdn-icons-png.flaticon.com/512/3652/3652191.png',
            'Pre-Examination': 'https://cdn-icons-png.flaticon.com/512/2641/2641409.png',
            'SAR Module': 'https://cdn-icons-png.flaticon.com/512/1162/1162951.png',
            'User Management': 'https://cdn-icons-png.flaticon.com/512/3061/3061341.png',
            'Budget Management': 'https://cdn-icons-png.flaticon.com/512/2652/2652234.png',
            'Fee Management': 'https://cdn-icons-png.flaticon.com/512/2489/2489756.png',
            'Pension Management': 'https://cdn-icons-png.flaticon.com/512/3281/3281323.png'
        } %}

        {% for mod in modules %}
            {% set mod_name = mod.modulename.strip() %}
            {% set ns = namespace(icon='') %}
            
            {# Perform robust name matching #}
            {% for key, icon in module_map.items() %}
                {% if key|lower in mod_name|lower or mod_name|lower in key|lower %}
                    {% set ns.icon = icon %}
                {% endif %}
            {% endfor %}

            {# Only display if it's one of the 21 requested modules #}
            {% if ns.icon %}
            <div class="module-item">
                <a href="{{ url_for('main.index', module_id=mod.pk_moduleId) }}" class="module-box" tabindex="0">
                    <img src="{{ ns.icon }}" class="module-icon-img">
                    <span class="module-name">{{ mod_name }}</span>
                </a>
            </div>
            {% endif %}
        {% endfor %}
    </div>
</div>
{% endblock %}
