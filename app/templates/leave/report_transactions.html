{% extends "base.html" %}
{% block content %}
{% block extra_head %}
<style>
    .tablesubheading { 
        background-color: #2d5a27 !important; 
        color: #ffffff !important; 
        font-weight: bold; 
        padding: 5px 10px; 
        font-size: 12px; 
        border: 1px solid #1e3d1a; 
        display: block; 
        width: 100%;
        box-sizing: border-box;
    }
</style>
{% endblock %}
<div class="hau-card">
    <div class="tablesubheading">Leave Transaction Report</div>
    <div style="padding: 15px;">
        <form method="GET" class="no-print">
            <table class="form-table">
                <tr>
                    <td class="vtext" width="15%">From Date</td><td class="colon">:</td>
                    <td><input type="date" name="from_date" class="textbox" value="{{ filters.from_date }}" style="width:150px;"></td>
                    <td class="vtext" width="15%">To Date</td><td class="colon">:</td>
                    <td><input type="date" name="to_date" class="textbox" value="{{ filters.to_date }}" style="width:150px;"></td>
                </tr>
                <tr>
                    <td class="vtext">Employee</td><td class="colon">:</td>
                    <td>
                        <input type="hidden" name="emp_id" id="emp_id" value="{{ filters.emp_id }}">
                        <input type="text" id="emp_name" class="textbox" style="width: 220px;" value="{{ selected_emp_name }}" readonly placeholder="Select employee...">
                        <img src="{{ url_for('static', filename='images/srec.jpg') }}" onclick="ShowSearch()" style="cursor:pointer; vertical-align:middle;">
                    </td>
                    <td class="vtext">DDO</td><td class="colon">:</td>
                    <td>
                        <select name="ddo_id" class="dropdown" style="width: 250px;">
                            <option value="">-- All DDO --</option>
                            {% for d in ddos %}<option value="{{ d.id }}" {% if d.id == filters.ddo_id %}selected{% endif %}>{{ d.name }}</option>{% endfor %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="vtext">Leave Type</td><td class="colon">:</td>
                    <td>
                        <select name="leave_id" class="dropdown" style="width: 200px;">
                            <option value="">-- All --</option>
                            {% for t in leave_types %}<option value="{{ t.id }}" {% if t.id|string == filters.leave_id %}selected{% endif %}>{{ t.name }}</option>{% endfor %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <td colspan="6" style="text-align: center; padding-top: 15px;">
                        <input type="submit" value="GENERATE REPORT" class="button-common" style="background:#3c8dbc; color:white;">
                        <input type="button" value="RESET" class="button-common" style="margin-left:5px;" onclick="window.location.href='{{ url_for('leave.leave_report_transactions') }}'">
                        <input type="button" value="PRINT" class="button-common" style="margin-left:5px;" onclick="window.print()">
                    </td>
                </tr>
            </table>
        </form>

        <div style="margin-top: 30px;">
            <table class="table-grid-view">
                <thead>
                    <tr class="header-style">
                        <td>S.No.</td><td>Emp Code</td><td>Name</td><td>Leave Type</td><td>From</td><td>To</td><td>Days</td><td>DDO</td><td>Remarks</td><td class="no-print">Action</td>
                    </tr>
                </thead>
                <tbody>
                    {% for t in transactions %}
                    <tr class="{% if loop.index % 2 == 0 %}item-style-alt{% else %}item-style{% endif %}">
                        <td align="center">{{ loop.index }}</td>
                        <td align="center">{{ t.empcode }}</td>
                        <td>{{ t.empname }}</td>
                        <td>{{ t.leavetype }}</td>
                        <td align="center">{{ t.fromdate.strftime('%d/%m/%Y') if t.fromdate else '' }}</td>
                        <td align="center">{{ t.todate.strftime('%d/%m/%Y') if t.todate else '' }}</td>
                        <td align="right"><b>{{ "{:,.2f}".format(t.totalleavedays|float) }}</b></td>
                        <td>{{ t.DDO }}</td>
                        <td>{{ t.remarks or '' }}</td>
                        <td align="center" class="no-print">
                            <a href="{{ url_for('leave.leave_adjustment', leave_id=t.pk_leavetakenid) }}" class="btn-hau">ADJUST</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="10" align="center" style="padding:20px;">No transactions found for the selected criteria.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="no-print">{% include 'includes/pagination.html' %}</div>
                </div>
            </div>
        </div>
        
        <script>
        function selectEmployee(id, name) {
            document.getElementById('emp_id').value = id;
            document.getElementById('emp_name').value = name;
        }
        </script>
        {% endblock %}
        