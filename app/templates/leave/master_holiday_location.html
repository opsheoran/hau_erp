{% extends "base.html" %}

{% block content %}
<div class="tableheading">Holiday Location Master</div>

<div class="hau-card" style="padding: 15px; margin-bottom: 20px;">
    <form method="POST" id="locForm">
        <input type="hidden" name="id" id="l_id">
        <input type="hidden" name="action" id="l_action" value="SAVE">
        
        <table class="form-table" style="width: 100%;">
            <tr>
                <td class="vtext" style="width: 15%;">Holiday Location</td>
                <td class="colon">:</td>
                <td class="required">
                    <input type="text" name="name" id="l_name" class="textbox w-250" maxlength="45" required> *
                </td>
            </tr>
            <tr>
                <td class="vtext">Display Order</td>
                <td class="colon">:</td>
                <td class="required">
                    <input type="number" name="order" id="l_order" class="textbox w-100" maxlength="3" required value="1"> *
                </td>
            </tr>
            <tr>
                <td class="vtext">Remarks</td>
                <td class="colon">:</td>
                <td>
                    <textarea name="remarks" id="l_remarks" class="textbox" rows="2" style="width: 300px; height: auto;"></textarea>
                </td>
            </tr>
            <tr>
                <td colspan="2"></td>
                <td style="padding-top: 15px;">
                    <button type="submit" class="button-common">SAVE</button>
                    <button type="button" class="button-common" style="margin-left: 10px;" onclick="resetForm()">RESET</button>
                </td>
            </tr>
        </table>
    </form>
</div>

<div class="tablesubheading">List of Holiday Locations</div>
<div class="hau-card" style="padding: 10px;">
    <table class="table-grid-view">
        <thead>
            <tr class="header-style">
                <th width="50">S.No.</th>
                <th style="width: 40%;">Holiday Location</th>
                <th style="width: 30%;">Display Order</th>
                <th width="80">EDIT</th>
                <th width="80">DELETE</th>
            </tr>
        </thead>
        <tbody>
            {% for l in locations %}
            <tr class="{% if loop.index % 2 == 0 %}item-style-alt{% else %}item-style{% endif %}">
                <td align="center">{{ (pagination.page - 1) * pagination.per_page + loop.index }}</td>
                <td>{{ l.holidayloc }}</td>
                <td align="center">{{ l.displayorder }}</td>
                <td align="center">
                    <img src="{{ url_for('static', filename='images/Edit.gif') }}" class="edit-btn" style="cursor:pointer" alt="Edit" title="Edit" 
                         data-id="{{ l.pk_holidaylocid }}"
                         data-name="{{ l.holidayloc }}"
                         data-order="{{ l.displayorder }}"
                         data-remarks="{{ l.remarks or '' }}">
                </td>
                <td align="center">
                    <form method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this location?')">
                        <input type="hidden" name="id" value="{{ l.pk_holidaylocid }}">
                        <input type="hidden" name="action" value="DELETE">
                        <input type="image" src="{{ url_for('static', filename='images/Delete.gif') }}" alt="Delete" title="Delete">
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" align="center" style="padding: 20px;">No locations found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% include "includes/pagination.html" %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.getElementById('l_id').value = this.getAttribute('data-id');
            document.getElementById('l_name').value = this.getAttribute('data-name');
            document.getElementById('l_order').value = this.getAttribute('data-order');
            document.getElementById('l_remarks').value = this.getAttribute('data-remarks');
            document.getElementById('l_action').value = 'SAVE';
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    });
});

function resetForm() {
    document.getElementById('l_id').value = '';
    document.getElementById('l_action').value = 'SAVE';
    document.getElementById('locForm').reset();
}
</script>
{% endblock %}
