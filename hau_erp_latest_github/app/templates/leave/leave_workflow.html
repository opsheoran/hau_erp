{% extends "base.html" %}
{% block content %}
<div class="hau-card">
    <div class="tablesubheading">Leave Work Flow (Reporting Officer Setup)</div>
    <div style="padding: 15px;">
        <form method="POST" style="max-width: 800px; margin: 0 auto;">
            <table class="form-table">
                <tr>
                    <td class="vtext" width="20%">Target Employee</td><td class="colon">:</td>
                    <td>
                        <input type="hidden" name="emp_id" id="emp_id">
                        <input type="text" id="emp_name" class="textbox" style="width: 250px;" readonly placeholder="Select employee...">
                        <img src="{{ url_for('static', filename='images/srec.jpg') }}" onclick="ShowSearch()" style="cursor:pointer; vertical-align:middle;">
                    </td>
                </tr>
                <tr>
                    <td class="vtext">Reporting Officer</td><td class="colon">:</td>
                    <td>
                        <select name="approver_id" class="dropdown" style="width: 300px;">
                            <option value="">-- Select Reporting Officer --</option>
                            {% for a in approvers %}
                            <option value="{{ a.id }}">{{ a.name }}</option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <td colspan="2"></td>
                    <td style="padding-top: 20px;">
                        <input type="submit" value="UPDATE REPORTING OFFICER" class="button-common" style="background:#3c8dbc; color:white; padding: 5px 20px;">
                        <input type="reset" value="RESET" class="button-common" style="margin-left:10px;">
                    </td>
                </tr>
            </table>
        </form>
    </div>
</div>

<!-- Search Modal -->
<div id="SearchDiv" class="white_content-new">
    <div style="text-align:right;"><span onclick="HideSearch()" style="cursor:pointer; color:red; font-weight:bold;">X</span></div>
    <div class="tableheading" style="margin-top:-15px;">Employee Search</div>
    <div style="padding:15px;">
        <table class="form-table">
            <tr>
                <td class="vtext">Search Employee</td><td class="colon">:</td>
                <td><input type="text" id="simple_search_term" class="textbox" style="width:250px;"></td>
                <td><input type="button" value="SEARCH" class="button-common" onclick="doSimpleSearch()"></td>
            </tr>
        </table>
        <div id="search_results" style="margin-top:20px; max-height:250px; overflow-y:auto;"></div>
    </div>
</div>

<script>
function ShowSearch() { document.getElementById('SearchDiv').style.display = 'block'; }
function HideSearch() { document.getElementById('SearchDiv').style.display = 'none'; }

async function doSimpleSearch() {
    const term = document.getElementById('simple_search_term').value;
    if(term.length < 2) return;
    const res = await fetch(`/leave/api/employee/search?term=${term}`);
    const data = await res.json();
    let html = '<table class="table-grid-view"><tr class="header-style"><td>Code</td><td>Name</td><td>Action</td></tr>';
    data.forEach(e => {
        html += `<tr class="item-style"><td>${e.id}</td><td>${e.name}</td><td><a href="javascript:void(0)" onclick="selectEmployee('${e.id}', '${e.name}')">Select</a></td></tr>`;
    });
    html += '</table>';
    document.getElementById('search_results').innerHTML = html;
}

function selectEmployee(id, name) {
    document.getElementById('emp_id').value = id;
    document.getElementById('emp_name').value = name;
    HideSearch();
}
</script>
{% endblock %}